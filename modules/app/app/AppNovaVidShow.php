<?php
namespace app\modules\app\app;
use app\modules\account\models\Account;
use app\modules\block\models\Block;
use app\modules\block\models\BlockMsg;
use app\modules\block\models\Msg;
use app\modules\car\models\Car;
use app\modules\helper\HelperModule;
use app\modules\helper\models\LoginCar;
use app\modules\helper\models\Logs;
use app\modules\zapros\models\Zapros;
use app\modules\user\models\User;
use yii\db\Exception;
use yii\debug\models\search\Log;
use yii\helpers\ArrayHelper;
use yii\httpclient\Client;

use yii\base\ErrorException;
/**
 * Created by PhpStorm.
 * User: heltru
 * Date: 04.03.2018
 * Time: 6:03
 */
final class AppNovaVidShow
{


    public  $deep=0;
    public  $deepC=0;

    public static function Instance()
    {
        static $inst = null;
        if ($inst === null) {
            $inst = new AppNovaVidShow();
        }
        return $inst;
    }


    public $formData;

    public function __construct()
    {

        $this->matrix_locales =  [[ [58.64725054149725,49.541381985546735],[58.65173931364867,49.549994014453205]],[[58.64725054149725,49.54999401445315],[58.65173931364867,49.55860604335967]],[[58.64725054149725,49.55860604335967],[58.65173931364867,49.56721807226614]],[[58.64725054149724,49.56721807226608],[58.651739313648704,49.57583010117265]],[[58.64725054149725,49.57583010117265],[58.65173931364867,49.58444213007917]],[[58.64725054149725,49.58444213007922],[58.65173931364867,49.59305415898568]],[[58.64725054149725,49.59305415898563],[58.65173931364867,49.60166618789215]],[[58.64725054149725,49.60166618789215],[58.65173931364867,49.61027821679861]],[[58.64725054149725,49.61027821679856],[58.65173931364867,49.61889024570508]],[[58.64725054149725,49.61889024570508],[58.65173931364867,49.627502274611544]],[[58.64725054149725,49.627502274611494],[58.65173931364867,49.63611430351801]],[[58.64725054149725,49.63611430351801],[58.65173931364867,49.644726332424476]],[[58.64725054149724,49.644726332424426],[58.651739313648704,49.653338361330995]],[[58.64725054149724,49.653338361330995],[58.651739313648704,49.661950390237564]],[[58.64725054149725,49.661950390237614],[58.65173931364867,49.670562419144076]],[[58.64725054149725,49.67056241914403],[58.65173931364867,49.679174448050546]],[[58.64725054149725,49.679174448050546],[58.65173931364867,49.68778647695701]],[[58.64725054149724,49.68778647695691],[58.651739313648704,49.69639850586348]],[[58.64725054149724,49.69639850586348],[58.651739313648704,49.70501053477005]],[[58.64276169535456,49.54138253820567],[58.647250470659586,49.54999346179427]],[[58.64276169535456,49.54999346179427],[58.647250470659586,49.55860438538282]],[[58.64276169535456,49.55860438538277],[58.647250470659586,49.56721530897137]],[[58.64276169535456,49.56721530897137],[58.647250470659586,49.575826232559926]],[[58.64276169535456,49.575826232559926],[58.647250470659586,49.584437156148475]],[[58.64276169535456,49.584437156148475],[58.647250470659586,49.593048079737024]],[[58.64276169535456,49.593048079736974],[58.647250470659586,49.60165900332558]],[[58.64276169535456,49.60165900332558],[58.647250470659586,49.61026992691418]],[[58.64276169535456,49.61026992691418],[58.647250470659586,49.61888085050273]],[[58.64276169535456,49.61888085050268],[58.647250470659586,49.62749177409128]],[[58.64276169535456,49.62749177409123],[58.64725047065962,49.63610269767988]],[[58.64276169535459,49.63610269767993],[58.64725047065957,49.64471362126844]],[[58.64276169535456,49.64471362126838],[58.647250470659586,49.653324544856986]],[[58.64276169535459,49.653324544857036],[58.64725047065957,49.661935468445535]],[[58.64276169535456,49.661935468445485],[58.647250470659586,49.67054639203403]],[[58.64276169535456,49.670546392033984],[58.647250470659586,49.67915731562259]],[[58.64276169535456,49.67915731562253],[58.64725047065962,49.68776823921119]],[[58.64276169535456,49.68776823921124],[58.647250470659586,49.69637916279979]],[[58.64276169535459,49.69637916279984],[58.64725047065957,49.70499008638829]],[[58.63827284607083,49.54568855249066],[58.642761624529705,49.55429837109778]],[[58.638272846070855,49.55429837109783],[58.642761624529676,49.56290818970484]],[[58.638272846070855,49.56290818970484],[58.642761624529676,49.57151800831185]],[[58.638272846070855,49.57151800831185],[58.642761624529676,49.58012782691886]],[[58.638272846070855,49.58012782691886],[58.642761624529676,49.588737645525875]],[[58.63827284607083,49.588737645525775],[58.642761624529705,49.59734746413289]],[[58.638272846070855,49.59734746413294],[58.642761624529676,49.60595728273995]],[[58.63827284607088,49.60595728274],[58.642761624529655,49.61456710134691]],[[58.638272846070855,49.61456710134686],[58.642761624529676,49.62317691995387]],[[58.638272846070855,49.62317691995382],[58.642761624529676,49.63178673856088]],[[58.638272846070855,49.63178673856088],[58.642761624529676,49.640396557167946]],[[58.63827284607083,49.6403965571679],[58.642761624529705,49.64900637577501]],[[58.638272846070855,49.64900637577501],[58.642761624529676,49.65761619438207]],[[58.638272846070855,49.65761619438207],[58.642761624529676,49.666226012989135]],[[58.638272846070855,49.666226012989135],[58.642761624529676,49.6748358315962]],[[58.638272846070855,49.6748358315962],[58.642761624529676,49.68344565020326]],[[58.638272846070855,49.68344565020326],[58.642761624529676,49.692055468810324]],[[58.638272846070855,49.692055468810324],[58.642761624529676,49.70066528741734]],[[58.638272846070855,49.70066528741734],[58.642761624529676,49.70927510602434]],[[58.63378399364575,49.541383643019074],[58.63827277525868,49.549992356980916]],[[58.63378399364575,49.549992356980916],[58.63827277525868,49.558601070942764]],[[58.63378399364575,49.55860107094282],[58.638272775258656,49.56720978490461]],[[58.63378399364575,49.56720978490461],[58.638272775258656,49.57581849886641]],[[58.63378399364575,49.57581849886646],[58.638272775258656,49.58442721282821]],[[58.63378399364575,49.58442721282821],[58.638272775258656,49.59303592678996]],[[58.63378399364575,49.5930359267899],[58.63827277525868,49.60164464075175]],[[58.63378399364575,49.6016446407518],[58.638272775258656,49.61025335471355]],[[58.63378399364575,49.61025335471345],[58.63827277525868,49.61886206867535]],[[58.63378399364575,49.6188620686754],[58.638272775258656,49.6274707826372]],[[58.63378399364575,49.6274707826372],[58.63827277525868,49.636079496599045]],[[58.63378399364575,49.636079496599045],[58.63827277525868,49.64468821056089]],[[58.63378399364575,49.64468821056089],[58.63827277525868,49.65329692452274]],[[58.63378399364575,49.65329692452274],[58.63827277525868,49.66190563848459]],[[58.63378399364575,49.66190563848464],[58.638272775258656,49.67051435244644]],[[58.63378399364575,49.67051435244644],[58.63827277525868,49.67912306640828]],[[58.63378399364575,49.67912306640828],[58.638272775258656,49.68773178037008]],[[58.63378399364575,49.68773178037013],[58.638272775258656,49.69634049433188]],[[58.63378399364575,49.69634049433188],[58.638272775258656,49.70494920829363]],[[58.62929513807899,49.54568855215444],[58.63378392284629,49.554296161807244]],[[58.62929513807899,49.554296161807194],[58.63378392284629,49.56290377146]],[[58.62929513807899,49.56290377146],[58.63378392284629,49.571511381112806]],[[58.62929513807899,49.571511381112806],[58.63378392284629,49.58011899076561]],[[58.629295138079016,49.58011899076561],[58.63378392284628,49.58872660041836]],[[58.629295138079016,49.58872660041836],[58.63378392284628,49.59733421007107]],[[58.629295138079016,49.59733421007102],[58.63378392284628,49.605941819723775]],[[58.629295138079016,49.605941819723775],[58.63378392284628,49.614549429376474]],[[58.62929513807899,49.614549429376424],[58.63378392284629,49.62315703902923]],[[58.629295138079016,49.62315703902923],[58.63378392284628,49.63176464868199]],[[58.629295138079016,49.63176464868204],[58.63378392284628,49.640372258334736]],[[58.62929513807899,49.64037225833464],[58.63378392284629,49.64897986798744]],[[58.629295138079016,49.64897986798744],[58.63378392284628,49.6575874776402]],[[58.62929513807899,49.65758747764015],[58.63378392284629,49.66619508729295]],[[58.62929513807899,49.6661950872929],[58.63378392284629,49.674802696945704]],[[58.629295138079016,49.674802696945754],[58.63378392284628,49.68341030659846]],[[58.62929513807899,49.68341030659836],[58.63378392284629,49.69201791625117]],[[58.629295138079016,49.69201791625122],[58.63378392284628,49.70062552590392]],[[58.629295138079016,49.70062552590387],[58.63378392284628,49.70923313555662]],[[58.62480627937041,49.54138474716013],[58.62929506729228,49.54999125283986]],[[58.62480627937041,49.54999125283986],[58.62929506729228,49.55859775851959]],[[58.62480627937041,49.55859775851959],[58.62929506729228,49.56720426419932]],[[58.62480627937041,49.56720426419932],[58.62929506729228,49.575810769879055]],[[58.62480627937041,49.575810769879055],[58.62929506729228,49.584417275558785]],[[58.62480627937041,49.584417275558785],[58.62929506729228,49.593023781238514]],[[58.62480627937041,49.593023781238514],[58.62929506729228,49.601630286918244]],[[58.62480627937041,49.601630286918244],[58.62929506729227,49.610236792597924]],[[58.62480627937041,49.610236792597874],[58.62929506729228,49.6188432982776]],[[58.62480627937041,49.61884329827766],[58.62929506729227,49.62744980395728]],[[58.62480627937041,49.627449803957184],[58.62929506729228,49.63605630963691]],[[58.62480627937041,49.63605630963696],[58.62929506729227,49.64466281531659]],[[58.62480627937041,49.64466281531654],[58.62929506729228,49.65326932099627]],[[58.62480627937041,49.65326932099627],[58.62929506729228,49.66187582667601]],[[58.62480627937041,49.66187582667601],[58.62929506729228,49.67048233235574]],[[58.62480627937041,49.67048233235574],[58.62929506729228,49.67908883803547]],[[58.62480627937041,49.67908883803547],[58.62929506729227,49.68769534371515]],[[58.62480627937041,49.68769534371515],[58.62929506729227,49.69630184939478]],[[58.62480627937041,49.69630184939473],[58.62929506729227,49.70490835507441]],[[58.620317417519615,49.54568855181862],[58.624806208596375,49.55429395386105]],[[58.620317417519615,49.55429395386105],[58.624806208596375,49.56289935590352]],[[58.620317417519615,49.56289935590352],[58.624806208596375,49.57150475794599]],[[58.620317417519615,49.57150475794599],[58.624806208596375,49.580110159988465]],[[58.620317417519615,49.580110159988465],[58.624806208596375,49.588715562030934]],[[58.620317417519615,49.588715562030934],[58.624806208596375,49.597320964073354]],[[58.620317417519615,49.597320964073255],[58.624806208596375,49.60592636611583]],[[58.620317417519615,49.60592636611588],[58.624806208596375,49.61453176815835]],[[58.620317417519615,49.6145317681583],[58.624806208596375,49.62313717020082]],[[58.620317417519615,49.62313717020082],[58.624806208596375,49.6317425722433]],[[58.620317417519615,49.6317425722433],[58.624806208596375,49.64034797428577]],[[58.620317417519615,49.64034797428567],[58.624806208596375,49.648953376328244]],[[58.620317417519615,49.64895337632829],[58.624806208596375,49.65755877837076]],[[58.620317417519615,49.65755877837076],[58.624806208596375,49.66616418041323]],[[58.620317417519644,49.66616418041323],[58.62480620859635,49.67476958245566]],[[58.620317417519644,49.67476958245571],[58.62480620859635,49.68337498449808]],[[58.620317417519615,49.68337498449797],[58.624806208596375,49.69198038654045]],[[58.620317417519615,49.69198038654045],[58.624806208596375,49.70058578858292]],[[58.620317417519644,49.70058578858297],[58.62480620859635,49.70919119062534]],[[58.61582855252649,49.54138585062945],[58.620317346758334,49.54999014937049]],[[58.61582855252649,49.54999014937049],[58.620317346758334,49.55859444811151]],[[58.6158285525265,49.55859444811156],[58.620317346758306,49.56719874685249]],[[58.6158285525265,49.56719874685249],[58.620317346758306,49.57580304559342]],[[58.6158285525265,49.57580304559337],[58.620317346758306,49.584407344334295]],[[58.61582855252649,49.584407344334195],[58.620317346758334,49.59301164307522]],[[58.6158285525265,49.59301164307527],[58.620317346758306,49.6016159418162]],[[58.6158285525265,49.6016159418162],[58.620317346758306,49.610220240557126]],[[58.61582855252649,49.61022024055708],[58.620317346758334,49.61882453929805]],[[58.61582855252649,49.61882453929805],[58.620317346758334,49.62742883803904]],[[58.61582855252649,49.62742883803898],[58.620317346758334,49.636033136780014]],[[58.6158285525265,49.636033136780064],[58.620317346758306,49.64463743552099]],[[58.6158285525265,49.64463743552099],[58.620317346758306,49.65324173426192]],[[58.6158285525265,49.65324173426192],[58.620317346758306,49.661846033002846]],[[58.61582855252653,49.661846033002895],[58.62031734675829,49.67045033174377]],[[58.6158285525265,49.67045033174377],[58.620317346758306,49.6790546304847]],[[58.6158285525265,49.6790546304847],[58.620317346758306,49.68765892922563]],[[58.61582855252649,49.68765892922558],[58.620317346758334,49.696263227966554]],[[58.615828552526466,49.696263227966455],[58.62031734675834,49.70486752670754]],[[58.61133968439061,49.54568855148296],[58.615828481777854,49.554291747258105]],[[58.61133968439063,49.554291747258105],[58.615828481777854,49.56289494303321]],[[58.61133968439063,49.56289494303326],[58.615828481777854,49.5714981388083]],[[58.61133968439063,49.5714981388083],[58.615828481777854,49.58010133458335]],[[58.61133968439063,49.5801013345833],[58.615828481777854,49.58870453035839]],[[58.61133968439061,49.58870453035834],[58.615828481777854,49.59730772613349]],[[58.61133968439061,49.59730772613344],[58.615828481777854,49.60591092190859]],[[58.61133968439061,49.60591092190859],[58.615828481777854,49.61451411768373]],[[58.61133968439061,49.61451411768373],[58.615828481777854,49.623117313458884]],[[58.61133968439061,49.623117313458884],[58.615828481777854,49.63172050923398]],[[58.61133968439061,49.63172050923393],[58.615828481777854,49.640323705009074]],[[58.61133968439061,49.640323705009024],[58.615828481777854,49.64892690078417]],[[58.61133968439063,49.648926900784225],[58.615828481777854,49.65753009655927]],[[58.61133968439061,49.657530096559164],[58.615828481777854,49.666133292334315]],[[58.61133968439063,49.666133292334365],[58.615828481777854,49.67473648810941]],[[58.61133968439063,49.67473648810941],[58.615828481777854,49.683339683884505]],[[58.61133968439063,49.683339683884505],[58.615828481777854,49.69194287965961]],[[58.61133968439066,49.691942879659656],[58.615828481777825,49.70054607543465]],[[58.61133968439063,49.7005460754346],[58.615828481777854,49.70914927120965]],[[58.60685081311184,49.541386953427654],[58.6113396136547,49.549989046572335]],[[58.60685081311184,49.549989046572335],[58.6113396136547,49.55859113971695]],[[58.60685081311184,49.5585911397169],[58.6113396136547,49.56719323286158]],[[58.60685081311184,49.56719323286153],[58.6113396136547,49.5757953260062]],[[58.60685081311185,49.57579532600625],[58.61133961365468,49.584397419150825]],[[58.60685081311185,49.584397419150825],[58.61133961365468,49.5929995122954]],[[58.60685081311184,49.59299951229529],[58.6113396136547,49.60160160543997]],[[58.60685081311185,49.60160160543997],[58.61133961365468,49.61020369858459]],[[58.60685081311184,49.61020369858454],[58.6113396136547,49.618805791729216]],[[58.60685081311185,49.618805791729265],[58.61133961365468,49.62740788487384]],[[58.60685081311185,49.62740788487379],[58.61133961365468,49.636009978018414]],[[58.60685081311184,49.636009978018365],[58.6113396136547,49.64461207116304]],[[58.60685081311184,49.64461207116299],[58.6113396136547,49.65321416430766]],[[58.60685081311184,49.65321416430766],[58.6113396136547,49.66181625745229]],[[58.60685081311184,49.66181625745223],[58.6113396136547,49.670418350596904]],[[58.60685081311185,49.67041835059696],[58.61133961365468,49.67902044374153]],[[58.60685081311185,49.67902044374148],[58.61133961365468,49.6876225368861]],[[58.60685081311184,49.68762253688605],[58.6113396136547,49.69622463003073]],[[58.60685081311185,49.69622463003078],[58.61133961365468,49.70482672317535]],[[58.6023619386899,49.54568855114755],[58.60685074238865,49.55428954199701]],[[58.6023619386899,49.55428954199701],[58.60685074238865,49.56289053284647]],[[58.6023619386899,49.56289053284647],[58.60685074238865,49.571491523695926]],[[58.6023619386899,49.571491523695926],[58.60685074238865,49.58009251454538]],[[58.60236193868993,49.580092514545434],[58.60685074238863,49.58869350539479]],[[58.6023619386899,49.58869350539474],[58.60685074238865,49.597294496244196]],[[58.6023619386899,49.597294496244196],[58.60685074238865,49.60589548709365]],[[58.6023619386899,49.60589548709365],[58.60685074238865,49.614496477943106]],[[58.6023619386899,49.614496477943106],[58.60685074238865,49.623097468792565]],[[58.6023619386899,49.623097468792565],[58.60685074238865,49.631698459642024]],[[58.6023619386899,49.631698459642024],[58.60685074238865,49.640299450491476]],[[58.6023619386899,49.640299450491476],[58.60685074238865,49.648900441340935]],[[58.6023619386899,49.648900441340935],[58.60685074238865,49.657501432190394]],[[58.6023619386899,49.657501432190394],[58.60685074238865,49.66610242303985]],[[58.6023619386899,49.66610242303985],[58.60685074238865,49.674703413889304]],[[58.60236193868988,49.674703413889205],[58.60685074238868,49.68330440473876]],[[58.60236193868988,49.68330440473871],[58.60685074238868,49.69190539558827]],[[58.6023619386899,49.69190539558832],[58.60685074238865,49.70050638643778]],[[58.6023619386899,49.70050638643778],[58.60685074238865,49.70910737728724]],[[58.59787306112447,49.541388055555245],[58.60236186797938,49.549987944444744]],[[58.59787306112449,49.549987944444744],[58.60236186797938,49.55858783333419]],[[58.59787306112449,49.55858783333424],[58.60236186797938,49.56718772222363]],[[58.59787306112447,49.56718772222353],[58.60236186797938,49.57578761111303]],[[58.59787306112447,49.57578761111303],[58.60236186797938,49.58438750000252]],[[58.59787306112449,49.58438750000252],[58.60236186797938,49.59298738889196]],[[58.59787306112447,49.59298738889191],[58.60236186797938,49.60158727778141]],[[58.59787306112447,49.60158727778136],[58.60236186797938,49.610187166670855]],[[58.59787306112452,49.610187166670954],[58.60236186797934,49.618787055560304]],[[58.59787306112447,49.6187870555602],[58.60236186797938,49.6273869444497]],[[58.59787306112449,49.627386944449746],[58.60236186797938,49.63598683333914]],[[58.59787306112447,49.63598683333909],[58.60236186797938,49.64458672222858]],[[58.59787306112447,49.64458672222858],[58.60236186797938,49.65318661111808]],[[58.59787306112447,49.65318661111803],[58.60236186797938,49.66178650000752]],[[58.59787306112449,49.66178650000757],[58.60236186797938,49.67038638889697]],[[58.59787306112447,49.670386388896915],[58.60236186797938,49.678986277786414]],[[58.59787306112447,49.678986277786414],[58.60236186797938,49.687586166675906]],[[58.59787306112449,49.687586166675906],[58.60236186797938,49.696186055565356]],[[58.59787306112447,49.696186055565306],[58.60236186797938,49.7047859444548]],[[58.59338418041531,49.5456885508125],[58.59787299042662,49.55428733807693]],[[58.5933841804153,49.55428733807683],[58.59787299042665,49.562886125341365]],[[58.59338418041531,49.562886125341365],[58.59787299042662,49.571484912605854]],[[58.5933841804153,49.571484912605804],[58.59787299042665,49.580083699870336]],[[58.59338418041531,49.580083699870336],[58.59787299042662,49.588682487134825]],[[58.59338418041531,49.588682487134825],[58.59787299042662,49.59728127439926]],[[58.59338418041534,49.59728127439926],[58.59787299042662,49.60588006166364]],[[58.59338418041531,49.60588006166359],[58.59787299042662,49.61447884892802]],[[58.59338418041534,49.61447884892802],[58.59787299042662,49.623077636192406]],[[58.59338418041531,49.623077636192356],[58.59787299042662,49.63167642345679]],[[58.59338418041534,49.63167642345679],[58.59787299042662,49.64027521072117]],[[58.59338418041534,49.64027521072117],[58.59787299042662,49.648873997985554]],[[58.59338418041534,49.648873997985554],[58.59787299042662,49.65747278524994]],[[58.59338418041534,49.65747278524994],[58.59787299042662,49.66607157251432]],[[58.59338418041534,49.66607157251432],[58.59787299042662,49.6746703597787]],[[58.59338418041531,49.67467035977865],[58.59787299042662,49.68326914704314]],[[58.59338418041531,49.68326914704314],[58.59787299042662,49.691867934307574]],[[58.59338418041534,49.691867934307574],[58.59787299042662,49.700466721571956]],[[58.59338418041531,49.70046672157191],[58.59787299042662,49.70906550883634]],[[58.588895296562185,49.54138915701278],[58.59338410973018,49.54998684298716]],[[58.588895296562185,49.54998684298721],[58.59338410973016,49.55858452896148]],[[58.588895296562185,49.55858452896148],[58.59338410973016,49.56718221493575]],[[58.588895296562185,49.5671822149357],[58.59338410973016,49.57577990091002]],[[58.588895296562185,49.57577990091002],[58.59338410973016,49.584377586884294]],[[58.588895296562185,49.584377586884244],[58.59338410973016,49.59297527285852]],[[58.588895296562185,49.59297527285852],[58.59338410973016,49.60157295883279]],[[58.588895296562185,49.60157295883279],[58.59338410973016,49.61017064480706]],[[58.588895296562185,49.61017064480706],[58.59338410973016,49.61876833078133]],[[58.588895296562185,49.61876833078133],[58.59338410973016,49.6273660167556]],[[58.588895296562185,49.6273660167556],[58.59338410973016,49.635963702729875]],[[58.588895296562185,49.635963702729825],[58.59338410973016,49.64456138870415]],[[58.588895296562185,49.64456138870415],[58.59338410973016,49.65315907467842]],[[58.588895296562185,49.65315907467832],[58.59338410973018,49.66175676065269]],[[58.588895296562185,49.66175676065269],[58.59338410973016,49.670354446626966]],[[58.588895296562185,49.67035444662686],[58.59338410973018,49.67895213260123]],[[58.588895296562185,49.67895213260118],[58.59338410973018,49.687549818575555]],[[58.588895296562185,49.687549818575555],[58.59338410973018,49.696147504549934]],[[58.588895296562185,49.696147504549984],[58.59338410973016,49.70474519052426]],[[58.5844064095648,49.54568855047765],[58.588895225889736,49.55428513549661]],[[58.58440640956482,49.55428513549661],[58.588895225889715,49.56288172051552]],[[58.58440640956485,49.56288172051557],[58.58889522588969,49.57147830553438]],[[58.58440640956485,49.57147830553438],[58.58889522588969,49.58007489055318]],[[58.58440640956485,49.58007489055318],[58.58889522588969,49.588671475571985]],[[58.58440640956482,49.588671475571935],[58.588895225889715,49.59726806059084]],[[58.58440640956482,49.59726806059084],[58.588895225889715,49.60586464560975]],[[58.58440640956482,49.60586464560975],[58.588895225889715,49.614461230628606]],[[58.58440640956482,49.61446123062856],[58.588895225889715,49.62305781564746]],[[58.58440640956482,49.62305781564746],[58.588895225889715,49.63165440066632]],[[58.58440640956482,49.63165440066632],[58.588895225889715,49.64025098568518]],[[58.5844064095648,49.64025098568508],[58.588895225889736,49.648847570704035]],[[58.58440640956482,49.648847570704035],[58.588895225889715,49.65744415572294]],[[58.5844064095648,49.65744415572289],[58.588895225889736,49.66604074074185]],[[58.5844064095648,49.6660407407418],[58.588895225889736,49.67463732576076]],[[58.58440640956482,49.67463732576081],[58.588895225889715,49.68323391077967]],[[58.58440640956485,49.68323391077967],[58.58889522588969,49.69183049579848]],[[58.58440640956482,49.69183049579842],[58.588895225889715,49.70042708081728]],[[58.58440640956482,49.70042708081723],[58.588895225889715,49.709023665836135]],[[58.57991751942297,49.54139025780093],[58.58440633890502,49.54998574219901]],[[58.57991751942295,49.54998574219891],[58.58440633890506,49.5585812265971]],[[58.57991751942297,49.55858122659715],[58.58440633890502,49.56717671099524]],[[58.57991751942297,49.56717671099524],[58.58440633890502,49.57577219539333]],[[58.57991751942297,49.57577219539333],[58.58440633890502,49.58436767979141]],[[58.57991751942297,49.58436767979141],[58.58440633890502,49.59296316418945]],[[58.57991751942297,49.5929631641894],[58.58440633890502,49.601558648587485]],[[58.57991751942297,49.601558648587485],[58.58440633890502,49.61015413298557]],[[58.57991751942297,49.61015413298557],[58.58440633890502,49.618749617383656]],[[58.579917519422985,49.618749617383656],[58.58440633890501,49.6273451017817]],[[58.57991751942297,49.6273451017817],[58.58440633890502,49.635940586179785]],[[58.57991751942297,49.635940586179785],[58.58440633890502,49.64453607057787]],[[58.57991751942297,49.64453607057787],[58.58440633890502,49.65313155497596]],[[58.57991751942297,49.65313155497596],[58.58440633890502,49.66172703937404]],[[58.57991751942297,49.66172703937404],[58.58440633890502,49.670322523772136]],[[58.57991751942297,49.670322523772136],[58.58440633890502,49.67891800817017]],[[58.579917519422985,49.67891800817017],[58.58440633890501,49.68751349256821]],[[58.57991751942297,49.68751349256815],[58.58440633890502,49.696108976966244]],[[58.57991751942297,49.696108976966244],[58.58440633890502,49.70470446136433]],[[58.57542862613638,49.54568855014316],[58.579917448775895,49.554282934254864]],[[58.57542862613638,49.554282934254815],[58.579917448775895,49.562877318366525]],[[58.57542862613641,49.562877318366525],[58.579917448775866,49.571471702478185]],[[58.57542862613638,49.57147170247813],[58.579917448775895,49.58006608658989]],[[58.57542862613638,49.58006608658989],[58.579917448775895,49.5886604707016]],[[58.57542862613641,49.5886604707016],[58.579917448775866,49.59725485481326]],[[58.57542862613642,49.59725485481331],[58.579917448775866,49.60584923892491]],[[58.57542862613638,49.60584923892481],[58.579917448775895,49.61444362303657]],[[58.57542862613638,49.61444362303657],[58.579917448775895,49.62303800714828]],[[58.57542862613641,49.62303800714828],[58.579917448775866,49.631632391259934]],[[58.57542862613641,49.631632391259934],[58.579917448775866,49.640226775371595]],[[58.57542862613641,49.640226775371595],[58.579917448775866,49.64882115948325]],[[58.57542862613641,49.64882115948325],[58.579917448775866,49.65741554359491]],[[58.57542862613641,49.65741554359491],[58.579917448775866,49.66600992770657]],[[58.57542862613641,49.66600992770657],[58.579917448775866,49.67460431181822]],[[58.57542862613641,49.67460431181817],[58.579917448775866,49.68319869592983]],[[58.57542862613641,49.68319869592983],[58.579917448775866,49.691793080041485]],[[58.57542862613638,49.691793080041386],[58.579917448775895,49.700387464153145]],[[58.57542862613638,49.700387464153145],[58.579917448775895,49.708981848264905]],[[58.5709397297048,49.54139135792018],[58.57542855550197,49.54998464207975]],[[58.5709397297048,49.5499846420797],[58.57542855550197,49.55857792623932]],[[58.5709397297048,49.55857792623932],[58.57542855550197,49.56717121039894]],[[58.570939729704804,49.56717121039894],[58.57542855550195,49.575764494558506]],[[58.5709397297048,49.575764494558456],[58.57542855550197,49.58435777871807]],[[58.5709397297048,49.58435777871807],[58.57542855550197,49.592951062877695]],[[58.5709397297048,49.592951062877695],[58.57542855550197,49.60154434703731]],[[58.5709397297048,49.60154434703731],[58.57542855550197,49.61013763119693]],[[58.5709397297048,49.61013763119693],[58.57542855550197,49.618730915356494]],[[58.5709397297048,49.618730915356444],[58.57542855550197,49.62732419951606]],[[58.5709397297048,49.62732419951606],[58.57542855550197,49.635917483675684]],[[58.5709397297048,49.635917483675684],[58.57542855550197,49.64451076783525]],[[58.5709397297048,49.64451076783525],[58.57542855550197,49.653104051994866]],[[58.5709397297048,49.653104051994866],[58.57542855550197,49.66169733615443]],[[58.5709397297048,49.66169733615438],[58.57542855550197,49.670290620314006]],[[58.5709397297048,49.670290620314006],[58.57542855550197,49.67888390447362]],[[58.5709397297048,49.67888390447362],[58.57542855550197,49.68747718863324]],[[58.5709397297048,49.68747718863324],[58.57542855550197,49.696070472792805]],[[58.5709397297048,49.696070472792805],[58.57542855550197,49.70466375695243]],[[58.56645083012794,49.54568854980892],[58.57093965908307,49.554280734350634]],[[58.56645083012794,49.554280734350634],[58.57093965908307,49.5628729188923]],[[58.56645083012794,49.5628729188923],[58.57093965908307,49.571465103433965]],[[58.56645083012794,49.571465103433916],[58.57093965908307,49.58005728797563]],[[58.56645083012794,49.58005728797563],[58.57093965908307,49.588649472517346]],[[58.566450830127955,49.588649472517396],[58.57093965908306,49.59724165705901]],[[58.56645083012794,49.59724165705896],[58.57093965908307,49.60583384160063]],[[58.566450830127955,49.60583384160063],[58.57093965908306,49.61442602614224]],[[58.56645083012794,49.61442602614219],[58.57093965908307,49.62301821068385]],[[58.566450830127955,49.62301821068385],[58.57093965908306,49.631610395225465]],[[58.56645083012794,49.631610395225415],[58.57093965908307,49.64020257976708]],[[58.56645083012794,49.64020257976708],[58.57093965908307,49.64879476430875]],[[58.56645083012794,49.6487947643087],[58.57093965908307,49.65738694885041]],[[58.566450830127955,49.65738694885046],[58.57093965908306,49.66597913339208]],[[58.56645083012794,49.66597913339202],[58.57093965908307,49.67457131793374]],[[58.56645083012794,49.67457131793374],[58.57093965908307,49.6831635024754]],[[58.566450830127955,49.6831635024754],[58.57093965908306,49.691755687017015]],[[58.56645083012792,49.691755687016865],[58.570939659083095,49.700347871558634]],[[58.56645083012794,49.700347871558634],[58.57093965908307,49.708940056100346]],[[58.56196192740553,49.541392457371074],[58.56645075951885,49.549983542628866]],[[58.56196192740553,49.549983542628866],[58.56645075951885,49.558574627886614]],[[58.56196192740553,49.558574627886614],[58.56645075951885,49.56716571314436]],[[58.56196192740553,49.56716571314436],[58.56645075951885,49.575756798402104]],[[58.5619619274055,49.575756798402004],[58.566450759518865,49.58434788365985]],[[58.56196192740553,49.5843478836599],[58.56645075951885,49.59293896891765]],[[58.56196192740553,49.59293896891765],[58.56645075951885,49.60153005417539]],[[58.5619619274055,49.60153005417534],[58.566450759518865,49.61012113943314]],[[58.56196192740553,49.61012113943314],[58.56645075951885,49.61871222469088]],[[58.5619619274055,49.61871222469078],[58.566450759518865,49.62730330994863]],[[58.56196192740553,49.62730330994863],[58.56645075951885,49.63589439520643]],[[58.56196192740553,49.63589439520643],[58.56645075951885,49.64448548046417]],[[58.561961927405534,49.64448548046417],[58.56645075951883,49.65307656572187]],[[58.56196192740553,49.65307656572182],[58.56645075951885,49.66166765097956]],[[58.56196192740553,49.66166765097956],[58.56645075951885,49.67025873623731]],[[58.5619619274055,49.67025873623726],[58.566450759518865,49.678849821495106]],[[58.56196192740553,49.678849821495106],[58.56645075951885,49.687440906752904]],[[58.56196192740553,49.687440906752904],[58.56645075951885,49.696031992010646]],[[58.56196192740553,49.696031992010646],[58.56645075951885,49.704623077268394]],[[58.55747302153732,49.54568854947494],[58.56196185680912,49.55427853578275]],[[58.55747302153732,49.55427853578275],[58.56196185680912,49.562868522090504]],[[58.5574730215373,49.562868522090405],[58.56196185680914,49.571458508398266]],[[58.55747302153732,49.571458508398315],[58.56196185680912,49.58004849470608]],[[58.55747302153732,49.58004849470603],[58.56196185680912,49.58863848101384]],[[58.55747302153735,49.58863848101384],[58.561961856809106,49.59722846732154]],[[58.55747302153732,49.59722846732149],[58.56196185680912,49.605818453629254]],[[58.55747302153735,49.605818453629254],[58.561961856809106,49.614408439936966]],[[58.55747302153735,49.614408439936966],[58.561961856809106,49.62299842624467]],[[58.55747302153735,49.62299842624467],[58.561961856809106,49.63158841255238]],[[58.55747302153735,49.63158841255238],[58.561961856809106,49.64017839886009]],[[58.55747302153732,49.64017839886004],[58.56196185680912,49.6487683851678]],[[58.55747302153735,49.6487683851678],[58.561961856809106,49.6573583714755]],[[58.55747302153732,49.657358371475404],[58.56196185680912,49.665948357783215]],[[58.55747302153732,49.665948357783215],[58.56196185680912,49.674538344090976]],[[58.5574730215373,49.67453834409087],[58.56196185680914,49.68312833039873]],[[58.55747302153732,49.68312833039873],[58.56196185680912,49.69171831670649]],[[58.55747302153735,49.69171831670649],[58.561961856809106,49.700308303014204]],[[58.55747302153732,49.700308303014154],[58.56196185680912,49.70889828932191]],[[58.55298411252306,49.54139355615424],[58.55747295095359,49.54998244384569]],[[58.55298411252306,49.54998244384564],[58.55747295095359,49.558571331537145]],[[58.55298411252308,49.558571331537195],[58.55747295095356,49.5671602192286]],[[58.55298411252306,49.56716021922855],[58.55747295095359,49.57574910692]],[[58.55298411252306,49.57574910691995],[58.55747295095359,49.58433799461145]],[[58.55298411252306,49.58433799461145],[58.55747295095359,49.592926882302955]],[[58.55298411252308,49.592926882302955],[58.55747295095356,49.60151576999436]],[[58.55298411252306,49.6015157699943],[58.55747295095359,49.61010465768581]],[[58.55298411252306,49.61010465768581],[58.55747295095359,49.618693545377255]],[[58.55298411252306,49.618693545377205],[58.55747295095359,49.62728243306866]],[[58.55298411252306,49.62728243306861],[58.55747295095359,49.63587132076011]],[[58.55298411252306,49.63587132076011],[58.55747295095359,49.64446020845156]],[[58.55298411252306,49.64446020845151],[58.55747295095359,49.653049096142965]],[[58.55298411252308,49.653049096142965],[58.55747295095356,49.66163798383436]],[[58.55298411252306,49.66163798383431],[58.55747295095359,49.67022687152576]],[[58.55298411252306,49.67022687152576],[58.55747295095359,49.678815759217215]],[[58.55298411252308,49.678815759217265],[58.55747295095356,49.68740464690862]],[[58.55298411252306,49.68740464690857],[58.55747295095359,49.69599353460002]],[[58.55298411252306,49.69599353460002],[58.55747295095359,49.704582422291466]],[[58.5484952003625,49.54568854914136],[58.55298404195197,49.55427633855008]],[[58.54849520036252,49.55427633855013],[58.552984041951966,49.562864127958804]],[[58.5484952003625,49.562864127958804],[58.55298404195197,49.57145191736752]],[[58.5484952003625,49.57145191736752],[58.55298404195197,49.58003970677619]],[[58.54849520036247,49.58003970677609],[58.552984041952,49.58862749618491]],[[58.54849520036252,49.58862749618501],[58.552984041951966,49.597215285593634]],[[58.5484952003625,49.597215285593585],[58.55298404195197,49.6058030750023]],[[58.5484952003625,49.6058030750023],[58.55298404195197,49.61439086441102]],[[58.5484952003625,49.61439086441102],[58.55298404195197,49.62297865381974]],[[58.5484952003625,49.62297865381974],[58.55298404195197,49.631566443228465]],[[58.5484952003625,49.631566443228465],[58.55298404195197,49.64015423263719]],[[58.5484952003625,49.64015423263719],[58.55298404195197,49.6487420220459]],[[58.5484952003625,49.6487420220459],[58.55298404195197,49.65732981145462]],[[58.5484952003625,49.65732981145462],[58.55298404195197,49.665917600863295]],[[58.5484952003625,49.665917600863246],[58.55298404195197,49.67450539027196]],[[58.54849520036252,49.67450539027202],[58.552984041951966,49.68309317968063]],[[58.5484952003625,49.68309317968053],[58.55298404195197,49.691680969089255]],[[58.5484952003625,49.691680969089255],[58.55298404195197,49.70026875849797]],[[58.5484952003625,49.70026875849797],[58.55298404195197,49.70885654790669]],[[58.54400628505537,49.54139465427021],[58.548495129804074,49.54998134572973]],[[58.54400628505539,49.549981345729776],[58.548495129804046,49.55856803718919]],[[58.54400628505537,49.55856803718919],[58.548495129804074,49.56715472864865]],[[58.54400628505537,49.56715472864865],[58.548495129804074,49.575741420108116]],[[58.54400628505537,49.575741420108116],[58.548495129804074,49.58432811156758]],[[58.54400628505539,49.584328111567636],[58.548495129804046,49.59291480302699]],[[58.54400628505537,49.59291480302689],[58.548495129804074,49.601501494486406]],[[58.54400628505537,49.601501494486406],[58.548495129804074,49.61008818594587]],[[58.54400628505537,49.61008818594587],[58.548495129804074,49.61867487740534]],[[58.54400628505537,49.61867487740534],[58.548495129804074,49.6272615688648]],[[58.54400628505537,49.6272615688648],[58.548495129804074,49.635848260324266]],[[58.54400628505537,49.635848260324266],[58.548495129804074,49.64443495178373]],[[58.54400628505537,49.64443495178373],[58.548495129804074,49.65302164324319]],[[58.54400628505537,49.65302164324319],[58.548495129804074,49.661608334702656]],[[58.54400628505537,49.661608334702606],[58.548495129804074,49.67019502616207]],[[58.54400628505537,49.67019502616207],[58.548495129804074,49.67878171762153]],[[58.54400628505537,49.67878171762153],[58.548495129804074,49.687368409080996]],[[58.54400628505537,49.687368409080996],[58.548495129804074,49.69595510054046]],[[58.54400628505537,49.69595510054046],[58.548495129804074,49.70454179199992]],[[58.5395173666014,49.54568854880794],[58.54400621450962,49.554274142651465]],[[58.53951736660143,49.554274142651465],[58.544006214509594,49.56285973649494]],[[58.53951736660143,49.56285973649494],[58.544006214509594,49.57144533033842]],[[58.53951736660143,49.57144533033842],[58.544006214509594,49.580030924181905]],[[58.5395173666014,49.58003092418185],[58.54400621450962,49.58861651802538]],[[58.5395173666014,49.58861651802533],[58.54400621450962,49.59720211186891]],[[58.5395173666014,49.59720211186891],[58.54400621450962,49.60578770571244]],[[58.5395173666014,49.60578770571239],[58.54400621450962,49.61437329955597]],[[58.5395173666014,49.61437329955597],[58.54400621450962,49.6229588933995]],[[58.53951736660143,49.6229588933995],[58.544006214509594,49.63154448724298]],[[58.53951736660143,49.63154448724298],[58.544006214509594,49.640130081086454]],[[58.53951736660143,49.640130081086454],[58.544006214509594,49.64871567492994]],[[58.5395173666014,49.64871567492988],[58.54400621450962,49.657301268773416]],[[58.5395173666014,49.65730126877337],[58.54400621450962,49.665886862616944]],[[58.5395173666014,49.665886862616944],[58.54400621450962,49.67447245646047]],[[58.5395173666014,49.67447245646042],[58.54400621450962,49.683058050304005]],[[58.5395173666014,49.683058050304005],[58.54400621450962,49.69164364414753]],[[58.5395173666014,49.69164364414748],[58.54400621450962,49.70022923799106]],[[58.5395173666014,49.70022923799106],[58.54400621450962,49.708814831834594]]];
    }

    public $is_order = false;
    public $quickOrderModel = [
        'user' => null,
        'account' => null,
        'block' => null,
        'msg' => null,

    ];
    public $quickOrderModelErrors = [
        'user' => null,
        'account' => null,
        'block' => null,
        'msg' => null,
        'block_link'=>null

    ];

    public $redirectPayUrlContent;


    public $matrix_locales =[];


    public function getRedirectPayForm(){
        $sendData = [
            'receiver' => '410015089945946',
            'quickpay-form' => 'donate',
            'targets' => 'Реклама в сервисе',
            'paymentType' => 'AC',
            'sum' => $this->formData->getSumm(),
            'need-phone'=>'true',
            'successURL' => 'https://hlynovonline.ru/payment/yandex/success-url',
        ];
    return $sendData;
     /*   $client = new Client(['baseUrl' => 'https://money.yandex.ru/quickpay/confirm.xml']);
        $response = $client->createRequest()
            ->setMethod('POST')
            //->setUrl('https://money.yandex.ru/quickpay/confirm.xml')
            ->setData($sendData)
            ->send();
        if ($response->isOk) {

        }
        $this->redirectPayUrlContent = $response->content;*/

    }

    public function setFormData( FormData $formData){
        $this->formData = $formData;
    }

    public function accauntFindByPhone($phone){
        $acc = Account::find()->joinWith('user_r')->andWhere(['user.phone'=>$phone])->one();
        return $acc;
    }

    public function qickOrderAddToAccaunt($account,$order,$summpay){
        $connection = \Yii::$app->db;
        $transaction = $connection->beginTransaction();
        try {
            $account->balance +=  $summpay;
            if ($account->save()){
                $this->quickOrderModel['account'] = $account;
                $block = new Block();
                $block->account_id = $account->id;
                $block->name = 'Быстрый заказ';
                $block->car_id = $order->car_id;
                $block->date_cr = HelperModule::convertDateToDatetime();
                $block->type  = Block::T_Q;
                $block->order_block = -1;
                if ($block->save()){
                    $this->quickOrderModel['block'] = $block;

                    $msg = new Msg();
                    $msg->block_id = $block->id;
                    $msg->type = Msg::T_T;
                    $msg->content  = $order->text;
                    $msg->date_cr = $date_cr;
                    $msg->car_id = $order->car_id;
                    $msg->count_limit = (int) $order->count_view /  3;

                    if ( $msg->count_limit > 0 && $msg->save() ){
                        $this->quickOrderModel['msg'] = $msg;

                        $block_link = new BlockMsg();
                        $block_link->msg_id = $msg->id;
                        $block_link->block_id = $block->id;
                        if($block_link->save()){

                            $this->quickOrderModel['block_link'] = $block_link;
                            $order->status = Zapros::ST_P;
                            $order->update(false,['status']);

                            $transaction->commit();
                            $this->sendUpdateListCar($order->car_id);

                            $this->is_order = true;
                            return true;

                        } else {
                            $this->quickOrderModelErrors['block_link'] = $block_link->getErrors();;
                        }


                    } else {
                        $this->quickOrderModelErrors['msg'] = $msg->getErrors();;
                    }

                } else {
                    $this->quickOrderModelErrors['block'] = $block->getErrors();;
                }
            } else {
                $this->quickOrderModelErrors['account'] = $account->getErrors();;
            }

        } catch (\Exception $e) {
            $transaction->rollBack();

            return false;
            //throw $e;
        } catch (\Throwable $e) {

            $transaction->rollBack();
            return false;
            //throw $e;
        }
    }

    public function qickOrderCreate($order,$summpay){


        $connection = \Yii::$app->db;
        $transaction = $connection->beginTransaction();
        try {
            $date_cr =  HelperModule::convertDateToDatetime();
            $user = new User();
            $user->phone = $order->phone;
            $user->setPassword(   rand(100000,999999) );
            $user->generateAuthKey();
            if ( $user->save()){

                $this->quickOrderModel['user'] = $user;
                $auth = \Yii::$app->authManager;
                $client = $auth->getRole('client');
                $auth->assign($client, $user->id);

                $account = new Account();
                $account->user_id = $user->id;
                $account->date_cr = $date_cr;
                $account->balance = $summpay;
                if ($account->save()){
                    $this->quickOrderModel['account'] = $account;
                    $block = new Block();
                    $block->account_id = $account->id;
                    $block->name = 'Быстрый заказ';
                    $block->car_id = $order->car_id;
                    $block->date_cr = $date_cr;
                    $block->type  = Block::T_Q;
                    $block->order_block = -1;
                    if ($block->save()){
                        $this->quickOrderModel['block'] = $block;

                        $msg = new Msg();
                        $msg->block_id = $block->id;
                        $msg->type = Msg::T_T;
                        $msg->content  = $order->text;
                        $msg->date_cr = $date_cr;
                        $msg->car_id = $order->car_id;
                        $msg->count_limit = (int) $order->count_view /  3;

                        if ( $msg->count_limit > 0 && $msg->save() ){
                            $this->quickOrderModel['msg'] = $msg;

                            $block_link = new BlockMsg();
                            $block_link->msg_id = $msg->id;
                            $block_link->block_id = $block->id;
                            if($block_link->save()){

                                $this->quickOrderModel['block_link'] = $block_link;
                                $order->status = Zapros::ST_P;
                                $order->update(false,['status']);

                                $transaction->commit();
                                $this->sendUpdateListCar($order->car_id);

                                $this->is_order = true;
                                return true;

                            } else {
                                $this->quickOrderModelErrors['block_link'] = $block_link->getErrors();;
                            }


                        } else {
                            $this->quickOrderModelErrors['msg'] = $msg->getErrors();;
                        }

                    } else {
                        $this->quickOrderModelErrors['block'] = $block->getErrors();;
                    }
                } else {
                    $this->quickOrderModelErrors['account'] = $account->getErrors();;
                }
            } else {
                $this->quickOrderModelErrors['user'] = $user->getErrors();
            }

        } catch (\Exception $e) {
            $transaction->rollBack();

            return false;
            //throw $e;
        } catch (\Throwable $e) {

            $transaction->rollBack();
            return false;
            //throw $e;
        }

Logs::log('qickOrderCreate',[$this->quickOrderModelErrors, $this->quickOrderModel,$this->quickOrderModelErrors]);

        return false;
    }

    public function refreshListOrder(){

    }





    private function whileLenta($group, $max){
        $st = [];

        for($i=0;$i<=(int)$max-1;$i++){
            foreach ($group as $acc_id => $msgs){




//                foreach ($msgs as $key=>$msg){ //calculate st end

                $cm = count($msgs);

                if($cm > 3){

                    $mi = (int) ceil( $cm / 3 );

                    $si = ($i % $mi);



                    $start = $si * 3;
                    $en = $start + 2;

                    //ex([$start,$en, $si , $mi , $cm]);

                    for ($k=$start;$k<=$en;$k++){

                        if( ! isset( $msgs[$k] ) ){
                           // ex([$start,$en,$k,$msgs,$i,$cm,$si,$mi]);
                            continue;
                        }

                        $st[] = $msgs[$k];


                    }
                 //   ex($st);

                } else {

                    switch ( $cm){
                        case 1:
                            $st[] = $msgs[0];
                            break;
                        case 2:
                            $st[] = $msgs[0];
                            $st[] = $msgs[1];
                            break;
                        case 3:
                            $st[] = $msgs[0];
                            $st[] = $msgs[1];
                            $st[] = $msgs[2];
                            break;
                        case 4:
                            if( ! $i % 2){
                                $st[] = $msgs[3];
                            } else {
                                $st[] = $msgs[0];
                                $st[] = $msgs[1];
                                $st[] = $msgs[2];

                            }
                            break;
                        case 5:
                            if( ! $i % 2){
                                $st[] = $msgs[3];
                                $st[] = $msgs[4];
                            } else {
                                $st[] = $msgs[0];
                                $st[] = $msgs[1];
                                $st[] = $msgs[2];

                            }
                            break;

                    }
                }





            }
        }
        return $st;
    }

    private function recursiveLenta($groups,$acc_Idr=null){
        $st = [];
        $this->deep ++;

        foreach ($groups as $acc_Id => $msgs){
            if ($acc_Id == $acc_Idr) {
                $this->deepC++;
               continue;
            }

            $i = 0;
            foreach ($msgs as $key => $msg){

                $st[] = $msg;
                unset($groups[$acc_Id][$key]);
                $i ++;

                $cc = count( $groups[$acc_Id]);



                $fl = $i == 3 || ( $i == 2 && $cc == 1 )  || ( $i == 1 && $cc == 0 ) ;

                if ($fl) {


                    return array_merge($st, $this->recursiveLenta($groups,$acc_Id));
                }
            }


        }

        return $st;
    }



    public function getListShow($car_id=null){



        $response = [
            'msg' =>  [],
            'broadcast' => [],
            'hash'=>''
        ];

         $blockMsg =  BlockMsg::find()->

         joinWith('block_r.account_r',true,'INNER JOIN')->
         innerJoin('user' ,'account.user_id = user.id')->
         joinWith('msg_r',true,'INNER JOIN')->

         andWhere(['msg.status'=>Msg::ST_OK,'account.status'=>Account::ST_OK,
             'block.status'=>[Block::ST_OK,Block::ST_TEST],'user.status'=>User::STATUS_ACTIVE])
         ->all();




         $all  = []; $hash = '';
         foreach ( $blockMsg as $item ){

             $time = ArrayHelper::getColumn($item->msg_r->daytime_r,'time_id');
             $region_p = [];
             foreach ($item->msg_r->locale_cost_r as $lc){
                 $region_p[] = ['locale_id'=>$lc->locale_id,  'cost'=> $lc->cost];
             }
             $region = ArrayHelper::getColumn($item->msg_r->locale_r,'locale_id');

             $all[$item->block_r->account_r->id][] =
                 [
                     'msg_id'=> $item->msg_r->id,
                     'account_sort'=> $item->msg_r->account_sort, //!,
                     'content' => $item->msg_r->content,
                     'type'=>$item->msg_r->type,
                     'region'=>$region,
                     'region_p'=>$region_p,
                     'time'=>$time,


                 ];

             $response['msg'][] = [
                 'msg_id' => $item->msg_r->id,
                 'content' => $item->msg_r->content,
             ];

             $response['hash'] .= (string)  $item->block_id .'-' . $item->msg_id . (string)strtotime($item->msg_r->date_update) . $item->msg_r->account_sort;



         }




         $groups = []; $max_i = 0;

         foreach ($all as $account_id => $account_msgs) {

             $sort = $all[$account_id];
             if (count($sort) > $max_i) {
                 $max_i = count($sort);
             }
             usort($sort, function ($a, $b) {
                 if ($a['account_sort'] == $b['account_sort']) {
                     return 0;
                 }
                 return ($a['account_sort'] < $b['account_sort']) ? -1 : 1;
             });

             $groups[$account_id] = $sort;


         }



        $groups = $this->whileLenta($groups,(int)ceil( $max_i /3),$response);




        $response['broadcast'] = $groups;

        $response['matrix_locales'] = $this->matrix_locales();


        $response['hash'] = md5($response['hash'] .  'pg9hbjfdsgfdfdsfdsfdsgfdggfgddfdsdfsfds5407fds7983fd123');



        return $response;



    }


    private function matrix_locales(){

        return $this->matrix_locales;


    }



    public function sendUpdateListCar($car_id){
        $car = Car::findOne(['id'=>$car_id]);
        if ($car === null) return null;

        $client = new Client();
        $response = $client->createRequest()
            ->setMethod('POST')
            ->setUrl($car->ip)
            ->setData([
                'action'=>'update',
                'sha_1' => sha1($car->secret .'action:update')
                 ])
            ->send();
        if ($response->isOk) {

            //$newUserId = $response->data['id'];
        }
    }



    public function checkOfflineCarState(){
        // cron every 5 min send request - check
    }

    private function validCarAuthData($data,$secret){
        if ( ! (  is_array($data) ||  count($data) )) return false;

        $valid = HelperModule::checkIsset('car_num', $data)
            && HelperModule::checkIsset('sha_1', $data)
            ;

        if (!$valid) return false;


        $strIn = '';
        $strIn  = HelperModule::getAVal('car_num', $data);
        $strIn .= $secret;


        return sha1($strIn) == HelperModule::getAVal('sha_1', $data);

    }





}